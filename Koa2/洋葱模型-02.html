<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>洋葱模型 02</title>
</head>
<body>
<script type="text/javascript">
  let sleep = (s = 2) => {
    return new Promise((resolve, reject) => {
      setTimeout(resolve, s * 1000)
    })
  }

  async function middleware_01 () {
    console.log('middleware_01 start')
    await middleware_02()
    console.log('middleware_01 end')
  }

  async function middleware_02 () {
    console.log('middleware_02 start')
    await middleware_03()
    console.log('middleware_02 end')
  }

  async function middleware_03 () {
    console.log('middleware_03 start')
    // await sleep()
    console.log('middleware_03 end')
  }

  function compose () {
    middleware_01()
    // console.log('compose end')
  }

  compose()

</script>
</body>
</html>
